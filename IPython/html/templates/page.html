<!DOCTYPE HTML>
<html>

<head>
    <meta charset="utf-8">

    <title>{% block title %}IPython Notebook{% endblock %}</title>
    {% block favicon %}<link rel="shortcut icon" type="image/x-icon" href="{{static_url("base/images/favicon.ico") }}">{% endblock %}
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link rel="stylesheet" href="{{static_url("components/jquery-ui/themes/smoothness/jquery-ui.min.css") }}" type="text/css" />


    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {% block stylesheet %}
    <link rel="stylesheet" href="{{ static_url("style/style.min.css") }}" type="text/css"/>
    {% endblock %}
    <link rel="stylesheet" href="{{ static_url("custom/custom.css") }}" type="text/css" />
    <link rel="stylesheet" href="{{static_url("components/dockspawn/css/dock-manager.css") }}" type="text/css"/>
    <link rel="stylesheet" href="{{static_url("components/dockspawn/css/demo.css") }}" type="text/css"/>

    <script src="{{static_url("components/dockspawn/dockspawn.js") }}" type="text/javascript" charset="utf-8"></script>
    <script src="{{static_url("components/es6-promise/promise.min.js")}}" type="text/javascript" charset="utf-8"></script>
    <script src="{{static_url("components/requirejs/require.js") }}" type="text/javascript" charset="utf-8"></script>

    <script>
      require.config({
          {% if version_hash %}
          urlArgs: "v={{version_hash}}",
          {% endif %}
          baseUrl: '{{static_url("", include_version=False)}}',
          paths: {
            nbextensions : '{{ base_url }}nbextensions',
            kernelspecs : '{{ base_url }}kernelspecs',
            underscore : 'components/underscore/underscore-min',
            backbone : 'components/backbone/backbone-min',
            jquery: 'components/jquery/jquery.min',
            bootstrap: 'components/bootstrap/js/bootstrap.min',
            bootstraptour: 'components/bootstrap-tour/build/js/bootstrap-tour.min',
            jqueryui: 'components/jquery-ui/ui/minified/jquery-ui.min',
            moment: 'components/moment/moment',
            codemirror: 'components/codemirror',
            termjs: 'components/term.js/src/term',
          },
          shim: {
            underscore: {
              exports: '_'
            },
            backbone: {
              deps: ["underscore", "jquery"],
              exports: "Backbone"
            },
            bootstrap: {
              deps: ["jquery"],
              exports: "bootstrap"
            },
            bootstraptour: {
              deps: ["bootstrap"],
              exports: "Tour"
            },
            jqueryui: {
              deps: ["jquery"],
              exports: "$"
            }
          }
      });

      require.config({
          map: {
              '*':{
                'contents': '{{ contents_js_source }}',
              }
          }
      });
    </script>

    {% block meta %}
    {% endblock %}

</head>

<body class="{% block bodyclasses %}{% endblock %}" {% block params %}{% endblock %}>

<noscript>
    <div id='noscript'>
      IPython Notebook requires JavaScript.<br>
      Please enable it to proceed.
  </div>
</noscript>

<!-- MAIN DOCKSPAWN DIV is that needed? -->
<div class="demo-header" id="header" style="width:100%">
<div id="header">
  <div id="header-container" class="container">
  <div id="ipython_notebook" class="nav navbar-brand pull-left"><a href="{{base_url}}tree" title='dashboard'>{% block logo %}<img src='{{static_url("base/images/logo.png") }}' alt='Jupyter Notebook'/>{% endblock %}</a></div>

  {% block login_widget %}

    <span id="login_widget">
      {% if logged_in %}
        <button id="logout" class="btn btn-sm navbar-btn">Logout</button>
      {% elif login_available and not logged_in %}
        <button id="login" class="btn btn-sm navbar-btn">Login</button>
      {% endif %}
    </span>

  {% endblock %}

  {% block headercontainer %}
  {% endblock %}
  </div>
  <div class="header-bar"></div>

  {% block header %}
  {% endblock %}
</div>

      <!-- CTAF: Injected at a better place in JS -->
      <!-- <div style="float: left;"> -->
        <!--     <a href="javascript:refresh()">Refresh</a> -->
        <!-- </div> -->

      <!-- <div class="demo-header-title">Dock Spawn IDE Demo</div> -->
      <!--   <div class="demo-header-description">Pull a panel out from it's title bar and dock it elsewhere</div> -->


    </div>
    <div id="my_dock_manager" class="my-dock-manager"></div>
    <div id="solution_window" data-panel-caption="Solution Explorer" data-panel-icon="fa fa-arrow-right" class="solution-window">
        <ul>
            <li id="solution_window_1">
                <a href="#">Test Project</a>
                <ul>
                    <li id="phtml_2"><a href="#">Source File 1</a></li>
                    <li id="phtml_3"><a href="#">Header File 1</a></li>
                </ul>
            </li>
            <li id="solution_window_2">
                <a href="#">My Project 2</a>
            </li>
        </ul>
    </div>
    <div id="properties_window" data-panel-caption="Properties" class="properties-window"></div>
    <div id="problems_window" data-panel-caption="Problems" class="problems-window"></div>

    <div id="editor1_window" data-panel-caption="Notebook" class="editor1-window editor-host">

<div id="site">
{% block site %}
{% endblock %}
</div>

{% block script %}
{% endblock %}

    </div>

    <div id="editor2_window" data-panel-caption="Notebook2" class="editor2-window editor-host"></div>
    <div id="infovis" data-panel-caption="Notebook3" class="editor2-window editor-host"></div>
    <div id="output_window" data-panel-caption="Output" class="output-window editor-host"></div>
    <div id="outline_window" data-panel-caption="Outline" class="outline-window"></div>
    <div id="toolbox_window" data-panel-caption="Toolbox" class="toolbox-window">
        <ul>
            <li id="toolbox_window_1"><a href="#">Tool 1</a></li>
            <li id="toolbox_window_2"><a href="#">Tool 2</a></li>
            <li id="toolbox_window_3"><a href="#">Tool 3</a></li>
            <li id="toolbox_window_4"><a href="#">Tool 4</a></li>
            <li id="toolbox_window_5"><a href="#">Tool 5</a></li>
        </ul>
    </div>
    <script>
        var dockManager,
            storeKey = 'lastState';

        function refresh() {
             localStorage.setItem(storeKey, '');
             location.reload();
        }

        window.onload = function () {

             $("#ctb_select").parent().append("<a href='javascript:refresh()'>Refresh</a>");
             $("#header-container").css("width", "100%");
             $("#menubar-container").css("width", "100%");
            // Convert a div to the dock manager. Panels can then be docked on to it
            var divDockManager = document.getElementById('my_dock_manager');
            dockManager = new dockspawn.DockManager(divDockManager);
            dockManager.initialize();

            var lastState = localStorage.getItem(storeKey);
            if (lastState) {
                dockManager.loadState(lastState);
            }

            // Let the dock manager element fill in the entire screen
            window.onresize = function () {
                console.log('divDocManagerleft+off:', divDockManager.clientLeft, divDockManager.offsetLeft)
                console.log('divDocManagertop+off:', divDockManager.clientTop, divDockManager.offsetTop)
                dockManager.resize(
                    window.innerWidth - (divDockManager.clientLeft + divDockManager.offsetLeft),
                    window.innerHeight - (divDockManager.clientTop + divDockManager.offsetTop)
                );
            };
            window.onresize();

            dockManager.addLayoutListener({
                onDock: function(self, dockNode){
                    console.log('onDock: ', self, dockNode);
                    localStorage.setItem(storeKey, dockManager.saveState());
                },
               onUndock:function(self, dockNode){
                    console.log('onUndock: ', self, dockNode);
                    localStorage.setItem(storeKey, dockManager.saveState());
                },
                onCreateDialog:function(self, dialog){
                    console.log('onCreateDialog: ', self, dialog);
                    localStorage.setItem(storeKey, dockManager.saveState());
                },
                onChangeDialogPosition:function(self, dialog, x, y){
                    console.log('onCreateDialog: ', self, dialog, x, y);
                    localStorage.setItem(storeKey, dockManager.saveState());
                },
                onResumeLayout:function(self){
                    console.log('onResumeLayout: ', self);
                    localStorage.setItem(storeKey, dockManager.saveState());
               },
               onClosePanel:function(self, panel){
                    console.log('onClosePanel: ', self, panel);
                    localStorage.setItem(storeKey, dockManager.saveState());
               },
               onHideDialog:function(self, dialog){
                    console.log('onHideDialog: ', self, dialog);
                    localStorage.setItem(storeKey, dockManager.saveState());
               },
               onShowDialog:function(self, dialog){
                    console.log('onShowDialog: ', self, dialog);
                    localStorage.setItem(storeKey, dockManager.saveState());
               }
            });


            if (!lastState) {
                // Convert existing elements on the page into "Panels".
                // They can then be docked on to the dock manager
                // Panels get a titlebar and a close button, and can also be
                // converted to a floating dialog box which can be dragged / resized
                var solution = new dockspawn.PanelContainer(document.getElementById("solution_window"), dockManager);
                var properties = new dockspawn.PanelContainer(document.getElementById("properties_window"), dockManager);
                var toolbox = new dockspawn.PanelContainer(document.getElementById("toolbox_window"), dockManager);
                var outline = new dockspawn.PanelContainer(document.getElementById("outline_window"), dockManager);
                var problems = new dockspawn.PanelContainer(document.getElementById("problems_window"), dockManager);
                var output = new dockspawn.PanelContainer(document.getElementById("output_window"), dockManager);
                var editor1 = new dockspawn.PanelContainer(document.getElementById("editor1_window"), dockManager);
                var editor2 = new dockspawn.PanelContainer(document.getElementById("editor2_window"), dockManager);
                var infovis = new dockspawn.PanelContainer(document.getElementById("infovis"), dockManager);

                // Dock the panels on the dock manager
                var documentNode = dockManager.context.model.documentManagerNode;
                var outlineNode = dockManager.dockLeft(documentNode, outline, 0.15);
                var solutionNode = dockManager.dockFill(outlineNode, solution);
                var propertiesNode = dockManager.dockDown(outlineNode, properties, 0.6);
                var outputNode = dockManager.dockDown(documentNode, output, 0.2);
                var problemsNode = dockManager.dockRight(outputNode, problems, 0.40);
                var toolboxNode = dockManager.dockRight(documentNode, toolbox, 0.20);
                var editor1Node = dockManager.dockFill(documentNode, editor1);
                var editor2Node = dockManager.dockFill(documentNode, editor2);
                var infovisNode = dockManager.dockFill(documentNode, infovis);
            }
        };
    </script>

</body>

</html>
